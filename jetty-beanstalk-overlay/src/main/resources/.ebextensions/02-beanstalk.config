files:
  "/opt/elasticbeanstalk/containerfiles/jetty.pill" :
    mode: "000644"
    owner: root
    group: users
    source: http://www.piratecode.org:8080/~jesse/stuff/beanstalk/jetty.pill

commands:
  0_replace:
    command: perl -pi -e "s/tomcat/jetty/g" containerconfiguration
    cwd: /opt/elasticbeanstalk/deploy/configuration
  0a_replace_gen:
    command: perl -pi -e "s/tomcat7/jetty8/g" generate_config.py
    cwd: /opt/elasticbeanstalk/containerfiles
  0b_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" generate_config.py
    cwd: /opt/elasticbeanstalk/containerfiles

  0c_replace_gen:
    command: perl -pi -e "s/tomcat7/jetty8/g" containerDefaults.py
    cwd: /opt/elasticbeanstalk/containerfiles
  0d_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" containerDefaults.py
    cwd: /opt/elasticbeanstalk/containerfiles

  0e_replace_gen:
    command: perl -pi -e "s/tomcat7/jetty8/g" 01deploy.sh
    cwd: /opt/elasticbeanstalk/hooks/configdeploy/enact
  0f_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 01deploy.sh
    cwd: /opt/elasticbeanstalk/hooks/configdeploy/enact

  0g_replace_gen:
    command: perl -pi -e "s/tomcat7/jetty8/g" 04config_deploy.sh
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/enact
  0h_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 04config_deploy.sh
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/enact

  0i_replace_gen:
    command: perl -pi -e "s/\/var\/lib\/tomcat7/\/opt\/jetty\/jetty-8/g" 03deploy.sh
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/enact

  0j_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 01start.sh
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/post

  0ka_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 01restart.sh
    cwd: /opt/elasticbeanstalk/hooks/restartappserver/enact
  0kb_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 02processmgrstart.sh
    cwd: /opt/elasticbeanstalk/hooks/postinit
  0kc_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 02processmgrstart.sh
    cwd: /opt/elasticbeanstalk/hooks/postinit
  0kd_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 02processmgrstart.sh
    cwd: /opt/elasticbeanstalk/hooks/postinitreboot

  0l_replace_gen:
    command: perl -pi -e "s/tomcat/jetty/g" 01stop.sh
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/enact

  0m_replace_gen:
    command: perl -pi -e "s/TOMCAT7/JETTY/g" 01misc.sh
    cwd: /opt/elasticbeanstalk/hooks/preinit

  0n_replace_gen:
    command: perl -pi -e "s/\/usr\/share\/tomcat7/\/opt\/jetty\/jetty-8/g" 01misc.sh
    cwd: /opt/elasticbeanstalk/hooks/preinit

  0o_replace_gen:
    command: perl -pi -e "s/CONF_HOME=\/etc\/tomcat7/PID=\/var\/run\/jetty8.pid/g" 01misc.sh
    cwd: /opt/elasticbeanstalk/hooks/preinit
  0o_replace_gen:
    command: echo "JETTY_PORT=8081" >> 01misc.sh
    cwd: /opt/elasticbeanstalk/hooks/preinit

  1_replace_port:
    command: perl -pi -e "s/\"80\"/\"8080\"/g" containerconfiguration
    cwd: /opt/elasticbeanstalk/deploy/configuration

  2_bundlelogs_conf:
    command: echo "/opt/jetty/jetty-8/logs/*" > jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/bundlelogs.d
  3_bundlelogs_perms:
    command: chmod 644 jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/bundlelogs.d

  4_systemtaillogs_conf:
    command: echo "/opt/jetty/jetty-8/logs/*.log" > jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/systemtaillogs.d
  5_systemtaillogs_perms:
    command: chmod 644 jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/systemtaillogs.d

  6_taillogs_conf:
    command: echo "/opt/jetty/jetty-8/logs/*.log" > jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/taillogs.d
  7_taillogs_perms:
    command: chmod 644 jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/taillogs.d

  8_publishlogs_conf:
    command: echo "/opt/jetty/jetty-8/logs/*.log" > jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/publishlogs.d
  9_publishlogs_perms:
    command: chmod 644 jetty8.conf
    cwd: /opt/elasticbeanstalk/tasks/publishlogs.d

